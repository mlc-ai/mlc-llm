





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>üöß Run Models in Android &mdash; mlc-llm 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tlcpack_theme.css" type="text/css" />

  
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="üöß Run Models in iOS" href="ios.html" />
    <link rel="prev" title="üöß Run Models in JavaScript" href="javascript.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://mlc.ai/mlc-llm>Home</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/mlc-ai/mlc-llm>Github</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://discord.gg/9Xpy2HGBuD>Discord Server</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   Other Resources
                 </button>
                 <ul>
                     <li>
                       <a href=https://mlc.ai/>MLC Course</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/blog>MLC Blog</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/web-llm>Web LLM</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Other Resources
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://mlc.ai/>MLC Course</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/blog>MLC Blog</a>
                     </li>
                     <li>
                       <a href=https://mlc.ai/web-llm>Web LLM</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/mlc-logo-with-text-landscape.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
                <div class="version">
                  0.1.0
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/mlcchat_terminologies.html">üöß Terminologies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Compiled Models</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cpp.html">Run Models in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="javascript.html">üöß Run Models in JavaScript</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">üöß Run Models in Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#app-build-instructions">App Build Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-your-own-model-weights">Use Your Own Model Weights</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ios.html">üöß Run Models in iOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">üöß Run Models with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compile Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../compilation/model_compilation_walkthrough.html">üöß Compile a Model in MLC LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/compiler_artifacts.html">üöß Compiler Artifact Spec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/configure_targets.html">üöß Configure Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/configure_quantization.html">üöß Configure Quantization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Define Model Architectures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../customize/define_new_models.html">üöß Define New Model Architectures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Prebuilt Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prebuilts/prebuilt_models.html">üöß Model Prebuilts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation and Dependency</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/tvm.html">Install TVM Unity</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../community/guideline.html">Community Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/software-dependencies.html">üöß Software Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy-models.html">How to Deploy Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compile-models.html">How to Compile Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bring-your-own-models.html">Add New Model Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customize-conversation.html">How to Customize Conversation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customize.html">Customize Model Compilation and Optimization</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- mlc-llm -->
              Table of Contents
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> <span class="br-arrow">></span></li>
        
      <li>üöß Run Models in Android</li>
    
    
      
      
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/mlc-ai/mlc-llm/edit/main/docs/tutorials/runtime/android.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="run-models-in-android">
<h1>üöß Run Models in Android<a class="headerlink" href="#run-models-in-android" title="Permalink to this heading">¬∂</a></h1>
<a class="reference internal image-reference" href="https://github.com/mlc-ai/mlc-llm/raw/main/site/gif/android-demo.gif"><img alt="https://github.com/mlc-ai/mlc-llm/raw/main/site/gif/android-demo.gif" class="align-center" src="https://github.com/mlc-ai/mlc-llm/raw/main/site/gif/android-demo.gif" style="width: 400px;" /></a>
<p>We are excited to share that we have enabled the Android support for
MLC-LLM. Checkout <a class="reference external" href="https://mlc.ai/mlc-llm/#android">the instruction
page</a> for instructions to download
and install our Android app. Checkout the <a class="reference external" href="https://mlc.ai/blog/2023/05/08/bringing-hardware-accelerated-language-models-to-android-devices">announcing blog
post</a>
for the technical details throughout our process of making MLC-LLM
possible for Android.</p>
<section id="app-build-instructions">
<h2>App Build Instructions<a class="headerlink" href="#app-build-instructions" title="Permalink to this heading">¬∂</a></h2>
<ol class="arabic">
<li><p>Install TVM Unity by following <a class="reference internal" href="../../install/tvm.html#tvm-unity-build-from-source"><span class="std std-ref">Option 2. Build from Source</span></a>.</p>
<p>Note that our pre-built wheels do not support OpenCL, and you need to built TVM-Unity
from source and set <code class="docutils literal notranslate"><span class="pre">USE_OPENCL</span></code> as <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p>
</li>
<li><p>Setup <code class="docutils literal notranslate"><span class="pre">TVM_NDK_CC</span></code> environment variable to NDK compiler path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace the /path/to/android/ndk/clang to your NDK compiler path</span>
<span class="c1"># e.g. export TVM_NDK_CC=/Users/me/Library/Android/sdk/ndk/25.2.9519653/toolchains/llvm/prebuilt/darwin-x86_64/bin/aarch64-linux-android24-clang</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TVM_NDK_CC</span><span class="o">=</span>/path/to/android/ndk/clang
</pre></div>
</div>
</li>
<li><p>Install <a class="reference external" href="https://maven.apache.org/download.cgi">Apache Maven</a> for
our Java dependency management. Run command <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">--version</span></code> to
verify that Maven is correctly installed.</p></li>
<li><p>Build TVM4j (Java Frontend for TVM Runtime) under the TVM Unity directory.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>jvm<span class="p">;</span><span class="w"> </span>mvn<span class="w"> </span>install<span class="w"> </span>-pl<span class="w"> </span>core<span class="w"> </span>-DskipTests<span class="w"> </span>-Dcheckstyle.skip<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
</li>
<li><p>Follow the instructions
<a class="reference external" href="https://github.com/mlc-ai/mlc-llm#building-from-source">here</a> to
either build the model using a Hugging Face URL, or a local
directory. If opting for a local directory, you can follow the
instructions
<a class="reference external" href="https://huggingface.co/docs/transformers/main/model_doc/llama">here</a>
to get the original LLaMA weights in the HuggingFace format, and
<a class="reference external" href="https://github.com/lm-sys/FastChat#vicuna-weights">here</a> to get
Vicuna weights.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># From mlc-llm project directory</span>
python3<span class="w"> </span>build.py<span class="w"> </span>--model<span class="w"> </span>path/to/vicuna-v1-7b<span class="w"> </span>--quantization<span class="w"> </span>q4f16_0<span class="w"> </span>--target<span class="w"> </span>android<span class="w"> </span>--max-seq-len<span class="w"> </span><span class="m">768</span>

<span class="c1"># If the model path is `dist/models/vicuna-v1-7b`,</span>
<span class="c1"># we can simplify the build command to</span>
<span class="c1"># python build.py --model vicuna-v1-7b --quantization q4f16_0 --target android --max-seq-len 768</span>
</pre></div>
</div>
</li>
<li><p>Build libraries for Android app.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">ANDROID_NDK</span><span class="o">=</span>/path/to/android/ndk
For<span class="w"> </span>example
<span class="nb">export</span><span class="w"> </span><span class="nv">ANDROID_NDK</span><span class="o">=</span>/Users/me/Library/Android/sdk/ndk/25.2.9519653
<span class="nb">cd</span><span class="w"> </span>android<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./prepare_libs.sh
</pre></div>
</div>
</li>
<li><p>Download <a class="reference external" href="https://developer.android.com/studio">Android Studio</a>,
and use Android Studio to open folder <code class="docutils literal notranslate"><span class="pre">android/MLCChat</span></code> as the
project.</p>
<ol class="arabic">
<li><p>Install Android SDK and NDK either inside Android Studio
(recommended) or separately.</p></li>
<li><p>Specify the Android SDK and NDK path in file
<code class="docutils literal notranslate"><span class="pre">android/MLCChat/local.properties</span></code> (if it does not exist, create
one):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sdk.dir<span class="o">=</span>/path/to/android/sdk
ndk.dir<span class="o">=</span>/path/to/android/ndk
</pre></div>
</div>
<p>For example, a good <code class="docutils literal notranslate"><span class="pre">local.properties</span></code> can be:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sdk.dir<span class="o">=</span>/Users/me/Library/Android/sdk
ndk.dir<span class="o">=</span>/Users/me/Library/Android/sdk/ndk/25.2.9519653
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Connect your Android device to your machine. In the menu bar of
Android Studio, click <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">-</span> <span class="pre">Make</span> <span class="pre">Project</span></code>.</p></li>
<li><p>Once the build is finished, click <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">-</span> <span class="pre">Run</span> <span class="pre">'app'</span></code>, and you will see the app launched on your phone.</p></li>
</ol>
<img alt="https://github.com/mlc-ai/mlc-llm/raw/main/site/img/android/android-studio.png" src="https://github.com/mlc-ai/mlc-llm/raw/main/site/img/android/android-studio.png" />
</section>
<section id="use-your-own-model-weights">
<h2>Use Your Own Model Weights<a class="headerlink" href="#use-your-own-model-weights" title="Permalink to this heading">¬∂</a></h2>
<p>By following the instructions above, the installed app will download
weights from our pre-uploaded HuggingFace repository. If you do not want
to download the weights from Internet and instead wish to use the
weights you build, please follow the steps below.</p>
<ul class="simple">
<li><p>Step 1 - step 9: same as <a class="reference external" href="#app-build-instructions">section ‚ÄùApp Build
Instructions‚Äù</a>.</p></li>
<li><p>Step 10. In <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">-</span> <span class="pre">Generate</span> <span class="pre">Signed</span> <span class="pre">Bundle</span> <span class="pre">/</span> <span class="pre">APK</span></code>, build the
project to an APK for release. If it is the first time you generate
an APK, you will need to create a key. Please follow <a class="reference external" href="https://developer.android.com/studio/publish/app-signing#generate-key">the official
guide from
Android</a>
for more instructions on this. After generating the release APK, you
will get the APK file <code class="docutils literal notranslate"><span class="pre">app-release.apk</span></code> under
<code class="docutils literal notranslate"><span class="pre">android/MLCChat/app/release/</span></code>.</p></li>
<li><p>Step 11. Enable ‚ÄúUSB debugging‚Äù in the developer options your phone
settings.</p></li>
<li><p>Step 12. Install <a class="reference external" href="https://developer.android.com/studio/releases/platform-tools">Android SDK
Platform-Tools</a>
for ADB (Android Debug Bridge). The platform tools will be already
available under your Android SDK path if you have installed SDK
(e.g., at <code class="docutils literal notranslate"><span class="pre">/path/to/android-sdk/platform-tools/</span></code>). Add the
platform-tool path to your PATH environment. Run <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">devices</span></code> to
verify that ADB is installed correctly your phone is listed as a
device.</p></li>
<li><p>Step 13. In command line, run the following command to install APK to your phone:</p></li>
</ul>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>adb<span class="w"> </span>install<span class="w"> </span>android/MLCChat/app/release/app-release.apk
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If it errors with message</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>adb:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>install<span class="w"> </span>android/MLCChat/app/release/app-release.apk:<span class="w"> </span>Failure<span class="w"> </span><span class="o">[</span>INSTALL_FAILED_UPDATE_INCOMPATIBLE:<span class="w"> </span>Existing<span class="w"> </span>package<span class="w"> </span>ai.mlc.mlcchat<span class="w"> </span>signatures<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span>newer<span class="w"> </span>version<span class="p">;</span><span class="w"> </span>ignoring!<span class="o">]</span>
</pre></div>
</div>
<p>please uninstall the existing app and try <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">install</span></code> again.</p>
</div>
</div></blockquote>
<ul>
<li><p>Step 14. Push the tokenizer and model weights to your phone through
ADB.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>adb<span class="w"> </span>push<span class="w"> </span>dist/models/vicuna-v1-7b/tokenizer.model<span class="w"> </span>/data/local/tmp/vicuna-v1-7b/tokenizer.model
adb<span class="w"> </span>push<span class="w"> </span>dist/vicuna-v1-7b/float16/params<span class="w"> </span>/data/local/tmp/vicuna-v1-7b/params
adb<span class="w"> </span>shell<span class="w"> </span><span class="s2">&quot;mkdir -p /storage/emulated/0/Android/data/ai.mlc.mlcchat/files/Download/&quot;</span>
adb<span class="w"> </span>shell<span class="w"> </span><span class="s2">&quot;mv /data/local/tmp/vicuna-v1-7b /storage/emulated/0/Android/data/ai.mlc.mlcchat/files/Download/vicuna-v1-7b&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Step 15. Everything is ready. Launch the MLCChat on your phone and
you will be able to use the app with your own weights. You will find
that no weight download is needed.</p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ios.html" class="btn btn-neutral float-right" title="üöß Run Models in iOS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="javascript.html" class="btn btn-neutral float-left" title="üöß Run Models in JavaScript" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../../_static/img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <div class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <div class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">¬© 2022 MLC LLM</h5>
        </div>
      </div>

    </div>

    <div>
      <div class="footernote"> </div>
    </div>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>